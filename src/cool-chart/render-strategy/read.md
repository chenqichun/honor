核心思路拆解
React Fiber 思想的应用：将 canvas 绘制任务拆分为小粒度工作单元（如 “绘制一个粒子”“更新一个图层”），每个单元可独立执行，且能记录执行状态（类似 Fiber 节点的 “中断 - 恢复” 机制）。同时引入优先级调度（如用户交互触发的绘制优先级高于背景动画），确保高优先级任务优先执行。
Web Worker 的作用：将计算密集型逻辑（如粒子物理运动、路径坐标计算、数据解析）移到 Worker 中，避免占用主线程时间。Worker 只负责输出 “绘制所需的结果数据”（如位置、大小、颜色），不参与实际绘制（canvas 操作必须在主线程）。
requestAnimationFrame 的调度：主线程通过 rAF 与浏览器渲染帧同步，每帧中仅用剩余可用时间（约 16.6ms 内）处理绘制任务单元，时间不足时暂停，下一帧继续，确保单帧耗时不超限，稳定帧率。
具体实现方案
1. 任务拆分与优先级设计（Fiber 核心）
参考 Fiber 的 “工作单元” 概念，将 canvas 绘制任务拆分为独立的 Task 单元，每个单元包含：
type：任务类型（如 PARTICLE、LAYER）；
priority：优先级（IMMEDIATE > USER_INTERACT > ANIMATION > LOW）；
execute：执行函数（接收绘制上下文和数据，完成部分绘制）；
data：Worker 传递的计算结果（如坐标、样式）；
next：下一个任务的引用（形成链表，便于中断后恢复）。

2. Web Worker 处理计算逻辑
Worker 负责处理耗时计算（如粒子位置更新），将结果通过消息发送给主线程。主线程收到后，将结果封装为 CanvasTask 加入任务队列。

3. 主线程调度器（结合 rAF 和 Fiber 调度）
主线程需要一个调度器（Scheduler），负责：
管理任务队列（按优先级排序）；
在 rAF 回调中，按帧的剩余时间处理任务单元（可中断）；
接收 Worker 结果并生成任务；
处理高优先级任务插队。
核心逻辑：每帧通过 rAF 触发，计算当前帧的剩余可用时间（16.6ms - 已消耗时间），从任务队列中取最高优先级任务执行，直到时间不足，记录任务执行状态（未完成的任务留到下一帧）。

4. 初始化与使用
在主线程中初始化 canvas、调度器，通过调度器触发计算和绘制：